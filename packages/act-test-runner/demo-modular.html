<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ACT Test Runner - Modular Architecture Demo</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }

    .demo-section {
      margin: 30px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      background: #007acc;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #005a9e;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .test-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .test-item {
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 4px;
    }

    .test-item img {
      max-width: 100%;
      height: auto;
    }

    .test-item.pass {
      border-color: #4caf50;
      background: #f1f8e9;
    }

    .test-item.fail {
      border-color: #f44336;
      background: #ffebee;
    }

    .test-item.skip {
      border-color: #ff9800;
      background: #fff3e0;
    }

    pre {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
    }

    .config-panel {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      margin: 20px 0;
    }

    .config-panel label {
      display: block;
      margin: 10px 0;
    }

    .config-panel input[type="checkbox"] {
      margin-right: 8px;
    }

    .config-panel select {
      margin-left: 8px;
      padding: 4px;
    }
  </style>
</head>
<body>
  <h1>üß™ ACT Test Runner - Modular Architecture Demo</h1>

  <div class="demo-section">
    <h2>üìã Configuration</h2>
    <div class="config-panel">
      <label>
        <input type="checkbox" id="performance" checked>
        Enable Performance Plugin
      </label>
      <label>
        <input type="checkbox" id="allyStudio">
        Enable AllyStudio Plugin (visual highlighting)
      </label>
      <label>
        Reporter:
        <select id="reporter">
          <option value="console">Console Reporter</option>
          <option value="minimal">Minimal Reporter</option>
          <option value="json">JSON Reporter</option>
        </select>
      </label>
      <label>
        <input type="checkbox" id="verbose">
        Verbose Output
      </label>
    </div>
  </div>

  <div class="demo-section">
    <h2>üéØ Test Content</h2>
    <div class="test-content">
      <!-- Good examples -->
      <div class="test-item">
        <h3>Good Image</h3>
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='60'%3E%3Crect fill='%234CAF50' width='100' height='60'/%3E%3Ctext x='50' y='35' text-anchor='middle' fill='white'%3EGood%3C/text%3E%3C/svg%3E" alt="A green rectangle showing good accessibility practices">
      </div>

      <div class="test-item">
        <h3>Good Button</h3>
        <button>Save Document</button>
      </div>

      <div class="test-item">
        <h3>Good Link</h3>
        <a href="#demo">Learn about accessibility testing</a>
      </div>

      <div class="test-item">
        <h3>Good Form</h3>
        <label for="email">Email Address:</label>
        <input type="email" id="email" placeholder="you@example.com">
      </div>

      <!-- Bad examples -->
      <div class="test-item">
        <h3>Bad Image</h3>
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='60'%3E%3Crect fill='%23F44336' width='100' height='60'/%3E%3Ctext x='50' y='35' text-anchor='middle' fill='white'%3EBad%3C/text%3E%3C/svg%3E">
      </div>

      <div class="test-item">
        <h3>Bad Button</h3>
        <button></button>
      </div>

      <div class="test-item">
        <h3>Bad Link</h3>
        <a href="#demo">Click here</a>
      </div>

      <div class="test-item">
        <h3>Bad Form</h3>
        <input type="text" placeholder="Enter your name">
      </div>
    </div>
  </div>

  <div class="controls">
    <button onclick="runTests()">üöÄ Run Tests</button>
    <button onclick="clearResults()">üßπ Clear Results</button>
    <button onclick="showConfig()">‚öôÔ∏è Show Config</button>
  </div>

  <div class="demo-section">
    <h2>üìä Results</h2>
    <pre id="results">Click "Run Tests" to see results...</pre>
  </div>

  <script type="module">
    import {
      configure,
      describe,
      test,
      runTests as run,
      expect,
      expectA11y,
      clear,
      reset,
      ConsoleReporter,
      MinimalReporter,
      JsonReporter,
      PerformancePlugin,
      AllyStudioPlugin
    } from './dist/index.js'

    // Store original console.log to capture output
    const originalLog = console.log
    const originalError = console.error
    let capturedOutput = []

    function captureConsole() {
      capturedOutput = []
      console.log = (...args) => {
        capturedOutput.push(args.join(' '))
        originalLog(...args)
      }
      console.error = (...args) => {
        capturedOutput.push('ERROR: ' + args.join(' '))
        originalError(...args)
      }
    }

    function restoreConsole() {
      console.log = originalLog
      console.error = originalError
    }

    // AllyStudio integration for visual highlighting
    const allyStudioIntegration = {
      highlightElement: (element, type) => {
        element.classList.remove('pass', 'fail', 'skip')
        element.classList.add(type)
      },
      clearHighlights: () => {
        document.querySelectorAll('.test-item').forEach(el => {
          el.classList.remove('pass', 'fail', 'skip')
        })
      },
      showTooltip: (element, message) => {
        // Simple tooltip implementation
        element.title = message
      }
    }

    // Define accessibility tests
    function defineTests() {
      describe('Image Accessibility', () => {
        test('should have alt text', ({ element }) => {
          expectA11y(element).toHaveValidAltText()
        }, 'img')
      })

      describe('Button Accessibility', () => {
        test('should have accessible name', ({ element }) => {
          expectA11y(element).toHaveAccessibleName()
        }, 'button')
      })

      describe('Link Accessibility', () => {
        test('should have meaningful text', ({ element }) => {
          expectA11y(element).toHaveMeaningfulLinkText()
        }, 'a')
      })

      describe('Form Accessibility', () => {
        test('should have proper label', ({ element }) => {
          expectA11y(element).toHaveProperLabel()
        }, 'input:not([type="hidden"])')
      })
    }

    window.runTests = async function() {
      try {
        // Clear previous state
        clear()
        reset()

        // Get configuration
        const performance = document.getElementById('performance').checked
        const allyStudio = document.getElementById('allyStudio').checked
        const reporter = document.getElementById('reporter').value
        const verbose = document.getElementById('verbose').checked

        // Configure test runner
        const config = {
          performance,
          reporter,
          reporterConfig: { verbose },
          allyStudio: allyStudio ? allyStudioIntegration : undefined
        }

        configure(config)

        // Define tests
        defineTests()

        // Capture console output
        captureConsole()

        // Run tests
        const results = await run()

        // Restore console and show results
        restoreConsole()

        document.getElementById('results').textContent = capturedOutput.join('\n')

        originalLog('‚úÖ Test run completed!', results)
      } catch (error) {
        restoreConsole()
        document.getElementById('results').textContent = `Error: ${error.message}\n${error.stack}`
        originalError('Test run failed:', error)
      }
    }

    window.clearResults = function() {
      document.getElementById('results').textContent = 'Click "Run Tests" to see results...'

      // Clear highlights
      document.querySelectorAll('.test-item').forEach(el => {
        el.classList.remove('pass', 'fail', 'skip')
      })
    }

    window.showConfig = function() {
      const performance = document.getElementById('performance').checked
      const allyStudio = document.getElementById('allyStudio').checked
      const reporter = document.getElementById('reporter').value
      const verbose = document.getElementById('verbose').checked

      const config = {
        performance,
        allyStudio,
        reporter,
        verbose
      }

      document.getElementById('results').textContent =
        'Current Configuration:\n' + JSON.stringify(config, null, 2)
    }

    // Auto-run on page load
    originalLog('üèóÔ∏è ACT Test Runner - Modular Architecture Demo loaded!')
    originalLog('üìö Available modules: Core, Plugins (Performance, AllyStudio, Expectations), Reporters (Console, JSON, Minimal)')
  </script>
</body>
</html>
